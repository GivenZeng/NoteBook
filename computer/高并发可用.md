根据业务场景平衡：性能、一致性、高可用（CAP）

## 高并发
要点：尽量减少请求/返回的数据、减少db操作、请求数少、链路短、系统可扩展(微服务化)

- 动静数据分离：静态数据使用CDN、动态数据使用统一缓存层/应用内缓存
    - 静态数据：
        - url为key、短链服务
        - 分离浏览者相关因素（这些属于动态，不应该影响静态数据服务）
        - 减少不必要的数据：cookie、地域数据等

    - 动态数据：
        - 本地cache层：尽量保存纯静态数据，不含、减少多机通信
        - 统一cache层：redis、memcache
            - 会涉及到缓存层、db层的一致性问题
            - 分布需要一致性
- 识别动态、静态数据
    - 通过先验知识判断数据热度
    - 通过用户动态用户行为计算热度，较为动态，一般通过日志做进行分析，使用队列等进行缓冲    

- 处理热点数据
    - 优化：缓存、LRU等
    - 限制：桶流量控制
    - 隔离：将热点服务与其他服务隔离，保证不影响其他服务

- 读写分离、分库分表等
- 加机器
- 数据编码：proto、thrift、avro、parquet等

- 流量削峰（在上述措施都无法较好完成的情况下考虑采用）
    - 排队：使用队列处理请求，增加缓冲带
    - 答题：延缓请求，过滤部分意愿不强的用户
    - 分层：将请求按照类型分层（比如nginx做转发：cdn服务、缓存服务、后台业务服务等）

- 兜底
    - 降级：对不重要的功能减少请求、返回的数量：比如将返回的数据从20改成10
    - 限流：漏桶、令牌桶、队列等方式。服务端、客户端都可以做（客户端设置最大并发请求量）
    - 拒绝服务：当系统达到一定阈值，直接拒绝服务
    - 熔断


这些东西需要在系统架构设计、编码、测试、发布、运行（监控）、维护等阶段都需要考虑。

- 合规、安全：TCPY等
- 合并

## 网盟相关
- 召回、粗排、精排、打包、点击、归因、数据分析等

redo log(重做日志)和undo log(回滚日志)。其中redo log用于保证事务持久性；undo log则是事务原子性和隔离性实现的基础。

redo log被引入来解决这个问题：当数据修改时，除了修改Buffer Pool中的数据，还会在redo log记录这次操作；当事务提交时，会调用fsync接口对redo log进行刷盘。如果MySQL宕机，重启时可以读取redo log中的数据，对数据库进行恢复。

undo log属于逻辑日志，它记录的是sql执行相关的信息。当发生回滚时，InnoDB会根据undo log的内容做与之前相反的工作：对于每个insert，回滚时会执行delete；对于每个delete，回滚时会执行insert；对于每个update，回滚时会执行一个相反的update，把数据改回去。

隔离性：锁和mvcc


一致性是指事务执行结束后，数据库的完整性约束没有被破坏，事务执行的前后都是合法的数据状态。数据库的完整性约束包括但不限于：实体完整性（如行的主键存在且唯一）、列完整性（如字段的类型、大小、长度要符合要求）、外键约束、用户自定义完整性（如转账前后，两个账户余额的和应该不变）。